# 密码找回功能（手机号验证）

本项目使用手机号验证码进行密码找回功能，已完全替换邮箱验证方式。

## 功能概述

- **手机号验证码**：用户通过手机号接收验证码
- **安全验证**：验证用户名和手机号匹配
- **令牌验证**：使用JWT令牌进行密码重置授权

## 实现细节

### 1. 用户模型更新

在User模型中，手机号字段已设置为必填项：

```javascript
phone: {
  field: 'phone',
  type: DataTypes.STRING(20),
  allowNull: false,
  unique: true,
  comment: '手机号码'
}
```

### 2. 短信服务

创建了独立的短信服务模块：

- **文件**：`src/utils/smsService.js`
- **功能**：提供验证码短信发送功能
- **当前实现**：开发环境下输出验证码到控制台

### 3. API接口

#### 3.1 发送验证码接口

**路径**：`POST /api/users/send-code`

**请求参数**：
```json
{
  "username": "用户名",
  "phone": "手机号码"
}
```

**返回结果**：
```json
{
  "code": 200,
  "message": "验证码已发送",
  "data": null
}
```

#### 3.2 验证验证码接口

**路径**：`POST /api/users/verify-code`

**请求参数**：
```json
{
  "username": "用户名",
  "phone": "手机号码",
  "code": "验证码"
}
```

**返回结果**：
```json
{
  "code": 200,
  "message": "验证码验证成功",
  "data": {
    "resetToken": "JWT令牌"
  }
}
```

#### 3.3 重置密码接口

**路径**：`POST /api/users/reset-password`

**请求参数**：
```json
{
  "resetToken": "JWT令牌",
  "newPassword": "新密码"
}
```

**返回结果**：
```json
{
  "code": 200,
  "message": "密码重置成功",
  "data": null
}
```

### 4. 配置说明

**环境变量**：目前使用模拟短信服务，无需额外配置。生产环境可在`.env`文件中配置真实短信服务参数。

## 生产环境配置

要在生产环境中使用真实短信服务，需要：

1. 选择短信服务提供商（如阿里云短信、腾讯云短信等）
2. 安装相应的SDK
3. 更新`smsService.js`中的实现
4. 在`.env`文件中配置API密钥等参数

## 注意事项

1. 验证码有效期为5分钟
2. 重置令牌有效期为10分钟
3. 开发环境下，验证码会输出到控制台
4. 生产环境请确保使用安全的短信服务提供商