# 短信服务配置文档

本文档详细介绍如何在项目中配置和使用短信服务，支持开发测试和生产环境部署。

## 支持的服务提供商

目前系统支持以下短信服务提供商：

1. **mock** - 模拟模式，仅在控制台打印短信内容，不实际发送
2. **spug** - Spug推送助手，用于发送验证码短信

## 配置步骤

### 1. 选择短信服务模式

在 `.env` 文件中设置短信服务提供商：

```
# 可选值: mock（模拟模式）、spug（Spug推送助手）
SMS_SERVICE_PROVIDER=spug
```

### 2. 配置对应服务的参数

根据选择的服务提供商，取消注释并填写相应的配置参数。

#### Mock模式

无需额外配置，验证码会输出到控制台。

```
SMS_SERVICE_PROVIDER=mock
```

## 开发环境设置

在开发环境中，推荐使用Mock模式：

1. 确保 `SMS_SERVICE_PROVIDER=mock`
2. 运行应用时，验证码会显示在控制台中
3. 直接使用控制台中显示的验证码进行测试

## Spug推送助手配置说明

### 1. Spug推送助手介绍

Spug推送助手是一个简单易用的消息推送服务，可以通过HTTP请求快速发送短信验证码。根据官方文档，我们可以使用特殊参数来动态设置接收对象。

### 2. 配置环境变量

在 `.env` 文件中添加以下配置：

```
# Spug推送助手配置
# 格式: https://push.spug.cc/send/{token}
SPUG_PUSH_URL=https://push.spug.cc/send/XlxGd8J43Vj2bn0R
```

### 3. 参数说明

根据Spug推送助手文档，发送请求时需要传递以下参数：

- `code`: 验证码参数
- `targets`: 目标手机号，可以是单个手机号或多个手机号（逗号分隔）

### 4. 推送URL格式

推送URL格式如下：
```
https://push.spug.cc/send/{token}?code={验证码}&targets={手机号}
```

## 生产环境部署

### 1. 安装必要的依赖

Spug推送助手使用标准HTTP请求，无需安装额外SDK。

### 2. 启用真实短信服务

1. 在生产环境的 `.env` 文件中设置正确的服务提供商：
   - 使用Spug推送助手：`SMS_SERVICE_PROVIDER=spug`
2. 填写所有必要的配置参数
3. 取消 `smsService.js` 中对应提供商代码块的注释

### 3. 安全注意事项

- **URL保护**：确保Spug推送URL不会被提交到代码仓库
- **环境变量**：在生产环境中使用环境变量存储敏感信息
- **定期更新**：定期更新Spug推送令牌以增强安全性

## 测试短信服务

系统启动时会自动验证短信配置。您也可以通过密码找回流程测试短信发送功能：

1. 调用 `/api/users/send-code` 接口发送验证码
2. 检查控制台输出（Mock模式）或手机短信（Spug推送助手）
3. 使用收到的验证码完成密码重置流程

## 常见问题

### 1. 配置正确但短信发送失败
- 检查Spug推送URL是否正确
- 网络连接是否正常
- 查看控制台错误日志获取详细信息

### 2. 验证码不显示在控制台
- 确保 `SMS_SERVICE_PROVIDER=mock`
- 检查日志输出位置

### 3. 生产环境切换到真实短信服务
- 确保已正确配置Spug推送URL
- 取消代码中对应服务的注释
- 配置所有必要的环境变量

### 4. 如何一次向多个手机号发送短信？
A: 在调用API时，可以将多个手机号用逗号分隔传递给targets参数：
```
targets=151xxxx0875,139xxxx7317
```